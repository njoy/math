#include "math/implementation/IteratorTaylorSeries.hpp"

namespace math {
namespace implementation {

/**
 * @brief Generate a new series representing the series integral
 * @param boundary The x-value for which the boundary condition exists
 * @param boundaryValue The y-value specified by the boundary condition
 * @result 
 * A vector of the coeffcients which can be use to construct a taylor series
 * representation of the indefinite integral of the calling series.
 */
template< typename iterator >
inline std::vector<double>
IteratorTaylorSeries<iterator>::integrate
(const double boundary, const double boundaryValue) const {
  std::vector<double> integralCoefficients;
  int order = (this->coefficientsEnd - this->coefficientsBegin) + 1;
  integralCoefficients.resize(order);
  auto integrandCoefficientIter = this->coefficientsEnd - 1;
  auto integralCoefficientIter = integralCoefficients.end() - 1;
  double accumulator = 0;
  while (--order){
    *integralCoefficientIter = *integrandCoefficientIter / double(order);
    accumulator = (*integralCoefficientIter + accumulator) * boundary;
    --integralCoefficientIter;
    --integrandCoefficientIter;
  }
  *integralCoefficientIter = boundaryValue - accumulator;
  return integralCoefficients;
}

} // implementation
} // math
